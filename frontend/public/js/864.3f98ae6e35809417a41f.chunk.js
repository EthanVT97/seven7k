"use strict";(self.webpackChunkseven7k_frontend=self.webpackChunkseven7k_frontend||[]).push([[864],{864:(e,r,t)=>{t.r(r),t.d(r,{default:()=>A});var a=t(4848),n=t(6540),s=t(2896),i=t(3476),l=t(6023),o=t(4112),c=function(){return c=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},c.apply(this,arguments)};const d=function(){var e=(0,s.d4)((function(e){return e.messages})),r=e.messages,t=e.activeChat,i=(0,n.useState)(""),l=i[0],d=i[1],u=r.map((function(e){return{id:e.id,name:"string"===typeof e.sender?e.sender:e.sender.name||"Unknown",lastMessage:e.content,timestamp:e.createdAt||e.timestamp||(new Date).toISOString(),unreadCount:"unread"===e.status?1:0,platform:e.platform}})).filter((function(e){return e.name.toLowerCase().includes(l.toLowerCase())||e.lastMessage.toLowerCase().includes(l.toLowerCase())||e.platform.toLowerCase().includes(l.toLowerCase())}));return(0,a.jsxs)("div",c({className:"h-full flex flex-col"},{children:[(0,a.jsx)("div",c({className:"p-4 border-b border-gray-200 dark:border-gray-700"},{children:(0,a.jsx)("input",{type:"text",value:l,onChange:function(e){return d(e.target.value)},placeholder:"Search chats...",className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})})),(0,a.jsx)("div",c({className:"flex-1 overflow-y-auto"},{children:0===u.length?(0,a.jsx)("div",c({className:"flex items-center justify-center h-32 text-gray-500 dark:text-gray-400"},{children:"No chats found"})):u.map((function(e){return(0,a.jsxs)("div",c({className:"p-4 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer transition-colors ".concat(t===e.id?"bg-gray-100 dark:bg-gray-700":"")},{children:[(0,a.jsxs)("div",c({className:"flex justify-between items-start"},{children:[(0,a.jsxs)("div",c({className:"flex-1"},{children:[(0,a.jsx)("h3",c({className:"font-medium text-gray-900 dark:text-white"},{children:e.name})),(0,a.jsx)("p",c({className:"text-sm text-gray-500 dark:text-gray-400 line-clamp-1"},{children:e.lastMessage}))]})),(0,a.jsxs)("div",c({className:"text-right"},{children:[(0,a.jsx)("p",c({className:"text-xs text-gray-500 dark:text-gray-400"},{children:(0,o.A)(new Date(e.timestamp),"HH:mm")})),e.unreadCount>0&&(0,a.jsx)("span",c({className:"inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-white bg-primary-600 rounded-full"},{children:e.unreadCount}))]}))]})),(0,a.jsx)("div",c({className:"mt-1"},{children:(0,a.jsx)("span",c({className:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-600 dark:text-gray-200"},{children:e.platform}))}))]}),e.id)}))}))]}))};var u=t(1447),f=t(591),m=t(5845);function g({title:e,titleId:r,...t},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":r},t),e?n.createElement("title",{id:r},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const x=n.forwardRef(g);var h=function(){return h=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},h.apply(this,arguments)};const p=function(e){var r=e.messages,t=e.loading,i=(0,n.useRef)(null),l=(0,s.d4)((function(e){return e.auth})).user;(0,n.useEffect)((function(){!function(){var e;null===(e=i.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}()}),[r]);var c=function(e){switch(e){case"sent":return(0,a.jsx)(x,{className:"h-4 w-4 text-gray-400"});case"delivered":return(0,a.jsxs)("div",h({className:"flex"},{children:[(0,a.jsx)(x,{className:"h-4 w-4 text-blue-500"}),(0,a.jsx)(x,{className:"h-4 w-4 -ml-2 text-blue-500"})]}));case"read":return(0,a.jsxs)("div",h({className:"flex"},{children:[(0,a.jsx)(x,{className:"h-4 w-4 text-green-500"}),(0,a.jsx)(x,{className:"h-4 w-4 -ml-2 text-green-500"})]}));default:return null}};if(t)return(0,a.jsx)("div",h({className:"flex-1 flex items-center justify-center"},{children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900 dark:border-white"})}));var d=function(e){var r=[],t=null;return e.forEach((function(e){var a=new Date(e.timestamp||e.createdAt||new Date);t&&(0,m.A)(t.date,a)?t.messages.push(e):(t&&r.push(t),t={date:a,messages:[e]})})),t&&r.push(t),r}(r);return(0,a.jsxs)("div",h({className:"flex-1 overflow-y-auto p-4 space-y-6"},{children:[d.map((function(e,r){return(0,a.jsxs)("div",h({className:"space-y-4"},{children:[(0,a.jsx)("div",h({className:"flex justify-center"},{children:(0,a.jsx)("span",h({className:"px-3 py-1 text-xs text-gray-500 bg-gray-100 dark:bg-gray-700 dark:text-gray-400 rounded-full"},{children:(t=e.date,(0,u.A)(t)?"Today":(0,f.A)(t)?"Yesterday":(0,o.A)(t,"MMMM d, yyyy"))}))})),e.messages.map((function(e){var r="string"===typeof e.sender?e.sender===(null===l||void 0===l?void 0:l.id):e.sender.id===(null===l||void 0===l?void 0:l.id);return(0,a.jsx)("div",h({className:"flex ".concat(r?"justify-end":"justify-start")},{children:(0,a.jsxs)("div",h({className:"max-w-[70%] rounded-lg px-4 py-2 ".concat(r?"bg-primary-600 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white")},{children:[(0,a.jsx)("p",h({className:"break-words"},{children:e.content})),(0,a.jsxs)("div",h({className:"flex items-center justify-end space-x-1 mt-1"},{children:[(0,a.jsx)("span",h({className:"text-xs opacity-75"},{children:(0,o.A)(new Date(e.timestamp||e.createdAt||new Date),"HH:mm")})),r&&c(e.status)]}))]}))}),e.id)}))]}),r);var t})),(0,a.jsx)("div",{ref:i})]}))};var y=t(6761);function b({title:e,titleId:r,...t},a){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":r},t),e?n.createElement("title",{id:r},e):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const v=n.forwardRef(b);var j=function(){return j=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},j.apply(this,arguments)},w=[{id:"whatsapp",name:"WhatsApp",icon:"\ud83d\udcf1"},{id:"facebook",name:"Facebook",icon:"\ud83d\udcd8"},{id:"telegram",name:"Telegram",icon:"\u2708\ufe0f"},{id:"line",name:"Line",icon:"\ud83d\udfe2"},{id:"viber",name:"Viber",icon:"\ud83d\udc9c"}];const k=function(){var e=n.useState(w[0]),r=e[0],t=e[1];return(0,a.jsxs)(y.W,j({as:"div",className:"relative inline-block text-left"},{children:[(0,a.jsxs)(y.W.Button,j({className:"inline-flex items-center justify-center w-full px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},{children:[(0,a.jsx)("span",j({className:"mr-2"},{children:r.icon})),r.name,(0,a.jsx)(v,{className:"w-5 h-5 ml-2 -mr-1","aria-hidden":"true"})]})),(0,a.jsx)(y.W.Items,j({className:"absolute z-10 w-56 mt-2 origin-top-left bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},{children:(0,a.jsx)("div",j({className:"py-1"},{children:w.map((function(e){return(0,a.jsx)(y.W.Item,{children:function(n){var s=n.active;return(0,a.jsxs)("button",j({onClick:function(){return t(e)},className:"".concat(s?"bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-200"," group flex items-center w-full px-4 py-2 text-sm")},{children:[(0,a.jsx)("span",j({className:"mr-3"},{children:e.icon})),e.name,r.id===e.id&&(0,a.jsx)("span",j({className:"absolute right-4"},{children:"\u2713"}))]}))}},e.id)}))}))}))]}))};var N=function(){return N=Object.assign||function(e){for(var r,t=1,a=arguments.length;t<a;t++)for(var n in r=arguments[t])Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n]);return e},N.apply(this,arguments)},C=function(e,r,t,a){return new(t||(t=Promise))((function(n,s){function i(e){try{o(a.next(e))}catch(r){s(r)}}function l(e){try{o(a.throw(e))}catch(r){s(r)}}function o(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t((function(e){e(r)}))).then(i,l)}o((a=a.apply(e,r||[])).next())}))},O=function(e,r){var t,a,n,s,i={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(l){return function(o){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(i=0)),i;)try{if(t=1,a&&(n=2&l[0]?a.return:l[0]?a.throw||((n=a.return)&&n.call(a),0):a.next)&&!(n=n.call(a,l[1])).done)return n;switch(a=0,n&&(l=[2&l[0],n.value]),l[0]){case 0:case 1:n=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,a=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(n=(n=i.trys).length>0&&n[n.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){i.label=l[1];break}if(6===l[0]&&i.label<n[1]){i.label=n[1],n=l;break}if(n&&i.label<n[2]){i.label=n[2],i.ops.push(l);break}n[2]&&i.ops.pop(),i.trys.pop();continue}l=r.call(e,i)}catch(o){l=[6,o],a=0}finally{t=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}};const A=function(){var e=this,r=(0,s.wA)(),t=(0,s.d4)((function(e){return e.messages})),o=t.messages,c=t.activeChat,u=t.loading,f=n.useState(""),m=f[0],g=f[1];n.useEffect((function(){c&&r((0,i.lj)(c))}),[c,r]);var x=function(){return C(e,void 0,void 0,(function(){return O(this,(function(e){switch(e.label){case 0:if(!m.trim()||!c)return[2];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,r((0,i._z)({content:m,recipient:c,platform:"whatsapp"})).unwrap()];case 2:return e.sent(),g(""),[3,4];case 3:return e.sent(),r((0,l.z8)({type:"error",message:"Failed to send message"})),[3,4];case 4:return[2]}}))}))};return(0,a.jsxs)("div",N({className:"flex h-full"},{children:[(0,a.jsx)("div",N({className:"w-1/4 border-r border-gray-200 dark:border-gray-700"},{children:(0,a.jsx)(d,{})})),(0,a.jsx)("div",N({className:"flex-1 flex flex-col"},{children:c?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",N({className:"p-4 border-b border-gray-200 dark:border-gray-700"},{children:(0,a.jsx)(k,{})})),(0,a.jsx)(p,{messages:o,loading:u}),(0,a.jsx)("div",N({className:"p-4 border-t border-gray-200 dark:border-gray-700"},{children:(0,a.jsxs)("div",N({className:"flex space-x-4"},{children:[(0,a.jsx)("input",{type:"text",value:m,onChange:function(e){return g(e.target.value)},placeholder:"Type your message...",className:"flex-1 rounded-lg border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white",onKeyPress:function(e){return"Enter"===e.key&&void x()}}),(0,a.jsx)("button",N({onClick:function(){x()},className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700"},{children:"Send"}))]}))}))]}):(0,a.jsx)("div",N({className:"flex items-center justify-center h-full text-gray-500 dark:text-gray-400"},{children:"Select a chat to start messaging"}))}))]}))}}}]);